am5.ready(function () {
	am5.addLicense("AM5C329334656");
	var root = {
		name: " ",
		color: "rgba(0,0,0,0)",
		children: [
			{
				name: "Welcome",
				color: "rgba(26,32,44,0.6)",
				children: [
					{
						name: "cluster",
						color: "#38d6ae",
						children: [
							{
								name: "AgglomerativeCluster",
								color: "#279c7f",
								size: 3938,
							},
							{
								name: "CommunityStructure",
								color: "#279c7f",
								size: 3812,
							},
							{
								name: "HierarchicalCluster",
								color: "#279c7f",
								size: 6714,
							},
							{
								name: "MergeEdge",
								color: "#279c7f",
								size: 743,
							},
							{
								name: "AgglomerativeCluster",
								color: "#279c7f",
								size: 938,
							},
							{
								name: "CommunityStructure",
								color: "#279c7f",
								size: 3812,
							},
							{
								name: "HierarchicalCluster",
								color: "#279c7f",
								size: 614,
							},
							{
								name: "MergeEdge",
								color: "#279c7f",
								size: 743,
							},
							{
								name: "AgglomerativeCluster",
								color: "#279c7f",
								size: 3938,
							},
							{
								name: "CommunityStructure",
								color: "#279c7f",
								size: 3812,
							},
							{
								name: "HierarchicalCluster",
								color: "#279c7f",
								size: 6714,
							},
							{
								name: "MergeEdge",
								color: "#279c7f",
								size: 743,
							},
							{
								name: "AgglomerativeCluster",
								color: "#279c7f",
								size: 338,
							},
							{
								name: "CommunityStructure",
								color: "#279c7f",
								size: 3812,
							},
							{
								name: "HierarchicalCluster",
								color: "#279c7f",
								size: 6714,
							},
							{
								name: "MergeEdge",
								color: "#279c7f",
								size: 743,
							},
						],
					},
					{
						name: "Cost Support",
						color: "#38d6ae",
						children: [
							{
								name: "BetweennessCentrality",
								color: "#279c7f",
								size: 3534,
							},
							{
								name: "LinkDistance",
								color: "#279c7f",
								size: 731,
							},
							{
								name: "MaxFlowMinCut",
								color: "#279c7f",
								size: 840,
							},
							{
								name: "ShortestPaths",
								color: "#279c7f",
								size: 5914,
							},
							{
								name: "SpanningTree",
								color: "#279c7f",
								size: 3416,
							},
						],
					},
				],
			},
			{
				name: "Injection",
				color: "rgba(26,32,44,0.6)",
				children: [
					{
						name: "DirtySprite",
						color: "#f971b4",
						size: 1833,
					},
					{
						name: "LineSprite",
						color: "#f971b4",
						size: 1732,
					},
					{
						name: "RectSprite",
						color: "#f971b4",
						size: 13623,
					},
					{
						name: "TextSprite",
						color: "#f971b4",
						size: 1066,
					},
				],
			},
			{
				name: "Side Effects",
				color: "rgba(26,32,44,0.6)",
				children: [
					{
						name: "DragForce",
						color: "#f94902",
						size: 1082,
					},
					{
						name: "GravityForce",
						color: "#f94902",
						size: 1336,
					},
					{
						name: "IForce",
						color: "#f94902",
						size: 1319,
					},
					{
						name: "NBodyForce",
						color: "#f94902",
						size: 1498,
					},
					{
						name: "Particle",
						color: "#f94902",
						size: 2822,
					},
					{
						name: "Simulation",
						color: "#f94902",
						size: 983,
					},
					{
						name: "Spring",
						color: "#f94902",
						size: 2213,
					},
					{
						name: "NBodyForce",
						color: "#f94902",
						size: 10498,
					},
					{
						name: "Particle",
						color: "#f94902",
						size: 2822,
					},
					{
						name: "Simulation",
						color: "#f94902",
						size: 983,
					},
					{
						name: "Spring",
						color: "#f94902",
						size: 2213,
					},
					{
						name: "SpringForce",
						color: "#f94902",
						size: 2681,
					},
				],
			},
			{
				name: "Refills",
				color: "rgba(26,32,44,0.6)",
				children: [
					{
						name: "AggregateExpression",
						color: "#611bff",
						size: 616,
					},
					{
						name: "And",
						color: "#611bff",
						size: 1027,
					},
					{
						name: "Arithmetic",
						color: "#611bff",
						size: 3891,
					},
					{
						name: "Average",
						color: "#611bff",
						size: 891,
					},
					{
						name: "DateUtil",
						color: "#611bff",
						size: 4141,
					},
					{
						name: "Distinct",
						color: "#611bff",
						size: 6933,
					},
					{
						name: "Expression",
						color: "#611bff",
						size: 5130,
					},
					{
						name: "methods",
						color: "#611bff",
						children: [
							{
								name: "add",
								color: "#4410bc",
								size: 593,
							},
							{
								name: "and",
								color: "#4410bc",
								size: 330,
							},
							{
								name: "average",
								color: "#4410bc",
								size: 287,
							},
							{
								name: "count",
								color: "#4410bc",
								size: 277,
							},
							{
								name: "distinct",
								color: "#4410bc",
								size: 292,
							},
							{
								name: "div",
								color: "#4410bc",
								size: 595,
							},
							{
								name: "eq",
								color: "#4410bc",
								size: 594,
							},
							{
								name: "fn",
								color: "#4410bc",
								size: 460,
							},
							{
								name: "gt",
								color: "#4410bc",
								size: 603,
							},
						],
					},
					{
						name: "Minimum",
						color: "#611bff",
						size: 843,
					},
					{
						name: "Not",
						color: "#611bff",
						size: 1554,
					},
					{
						name: "Or",
						color: "#611bff",
						size: 970,
					},
					{
						name: "Query",
						color: "#611bff",
						size: 1896,
					},
					{
						name: "Range",
						color: "#611bff",
						size: 1594,
					},
					{
						name: "StringUtil",
						color: "#611bff",
						size: 430,
					},
					{
						name: "Sum",
						color: "#611bff",
						size: 791,
					},
					{
						name: "Variable",
						color: "#611bff",
						size: 1124,
					},
					{
						name: "Variance",
						color: "#611bff",
						size: 1876,
					},
					{
						name: "Xor",
						color: "#611bff",
						size: 1101,
					},
				],
			},
			{
				name: "Mental Health",
				color: "rgba(26,32,44,0.6)",
				children: [
					{
						name: "Arrays",
						color: "#0dbeff",
						size: 858,
					},
					{
						name: "Colors",
						color: "#0dbeff",
						size: 1001,
					},
					{
						name: "Dates",
						color: "#0dbeff",
						size: 8217,
					},
					{
						name: "Displays",
						color: "#0dbeff",
						size: 1255,
					},
					{
						name: "Filter",
						color: "#0dbeff",
						size: 2324,
					},
					{
						name: "Geometry",
						color: "#0dbeff",
						size: 1993,
					},
					{
						name: "heap",
						color: "#0dbeff",
						children: [
							{
								name: "FibonacciHeap",
								color: "#247aa2",
								size: 9354,
							},
							{
								name: "HeapNode",
								color: "#247aa2",
								size: 1233,
							},
						],
					},
					{
						name: "IEvaluable",
						color: "#0dbeff",
						size: 335,
					},
					{
						name: "IPredicate",
						color: "#0dbeff",
						size: 383,
					},
					{
						name: "IValueProxy",
						color: "#0dbeff",
						size: 874,
					},
					{
						name: "math",
						color: "#0dbeff",
						children: [
							{
								name: "DenseMatrix",
								color: "#247aa2",
								size: 3165,
							},
							{
								name: "IMatrix",
								color: "#247aa2",
								size: 2815,
							},
							{
								name: "SparseMatrix",
								color: "#247aa2",
								size: 3366,
							},
						],
					},
					{
						name: "Maths",
						color: "#0dbeff",
						size: 1705,
					},
					{
						name: "Orientation",
						color: "#0dbeff",
						size: 1486,
					},
					{
						name: "palette",
						color: "#0dbeff",
						children: [
							{
								name: "ColorPalette",
								color: "#247aa2",
								size: 667,
							},
							{
								name: "Palette",
								color: "#247aa2",
								size: 1229,
							},
							{
								name: "ShapePalette",
								color: "#247aa2",
								size: 2059,
							},
							{
								name: "SizePalette",
								color: "#247aa2",
								size: 2291,
							},
						],
					},
					{
						name: "Property",
						color: "#0dbeff",
						size: 559,
					},
					{
						name: "Shapes",
						color: "#0dbeff",
						size: 1118,
					},
					{
						name: "Sort",
						color: "#0dbeff",
						size: 6887,
					},
					{
						name: "Stats",
						color: "#0dbeff",
						size: 6557,
					},
					{
						name: "Strings",
						color: "#0dbeff",
						size: 2026,
					},
				],
			},
			{
				name: "Cost Support",
				color: "rgba(26,32,44,0.6)",
				children: [
					{
						name: "axis",
						color: "#38d6ae",
						children: [
							{
								name: "Axes",
								color: "#279c7f",
								size: 1302,
							},
							{
								name: "Axis",
								color: "#279c7f",
								size: 593,
							},
							{
								name: "AxisGridLine",
								color: "#279c7f",
								size: 652,
							},
							{
								name: "AxisLabel",
								color: "#279c7f",
								size: 636,
							},
							{
								name: "CartesianAxes",
								color: "#279c7f",
								size: 703,
							},
						],
					},
					{
						name: "data",
						color: "#38d6ae",
						children: [
							{
								name: "Data",
								color: "#279c7f",
								size: 244,
							},
							{
								name: "DataList",
								color: "#279c7f",
								size: 1788,
							},
							{
								name: "DataSprite",
								color: "#279c7f",
								size: 1349,
							},
							{
								name: "EdgeSprite",
								color: "#279c7f",
								size: 3301,
							},
							{
								name: "NodeSprite",
								color: "#279c7f",
								size: 1382,
							},
							{
								name: "render",
								color: "#279c7f",
								children: [
									{
										name: "ArrowType",
										color: "#1a745d",
										size: 698,
									},
									{
										name: "EdgeRenderer",
										color: "#1a745d",
										size: 5569,
									},
									{
										name: "IRenderer",
										color: "#1a745d",
										size: 353,
									},
									{
										name: "ShapeRenderer",
										color: "#1a745d",
										size: 2247,
									},
								],
							},
							{
								name: "ScaleBinding",
								color: "#279c7f",
								size: 1275,
							},
							{
								name: "Tree",
								color: "#279c7f",
								size: 7147,
							},
							{
								name: "TreeBuilder",
								color: "#279c7f",
								size: 930,
							},
						],
					},
					{
						name: "events",
						color: "#38d6ae",
						children: [
							{
								name: "DataEvent",
								color: "#1a745d",
								size: 2313,
							},
							{
								name: "SelectionEvent",
								color: "#1a745d",
								size: 1880,
							},
							{
								name: "TooltipEvent",
								color: "#1a745d",
								size: 1701,
							},
							{
								name: "VisualizationEvent",
								color: "#1a745d",
								size: 1117,
							},
						],
					},
					{
						name: "legend",
						color: "#38d6ae",
						children: [
							{
								name: "Legend",
								color: "#279c7f",
								size: 20859,
							},
							{
								name: "LegendItem",
								color: "#279c7f",
								size: 4614,
							},
							{
								name: "LegendRange",
								color: "#279c7f",
								size: 10530,
							},
						],
					},
					{
						name: "Support",
						color: "#38d6ae",
						children: [
							{
								name: "label",
								color: "#279c7f",
								children: [
									{
										name: "Labeler",
										color: "#1a745d",
										size: 956,
									},
									{
										name: "RadialLabeler",
										color: "#1a745d",
										size: 299,
									},
									{
										name: "StackedAreaLabeler",
										color: "#1a745d",
										size: 202,
									},
								],
							},
							{
								name: "layout",
								color: "#279c7f",
								children: [
									{
										name: "AxisLayout",
										color: "#1a745d",
										size: 725,
									},
									{
										name: "NodeLinkTreeLayout",
										color: "#1a745d",
										size: 1870,
									},
									{
										name: "PieLayout",
										color: "#1a745d",
										size: 2728,
									},
									{
										name: "RadialTreeLayout",
										color: "#1a745d",
										size: 1348,
									},
									{
										name: "RandomLayout",
										color: "#1a745d",
										size: 870,
									},
									{
										name: "StackedAreaLayout",
										color: "#1a745d",
										size: 2121,
									},
									{
										name: "TreeMapLayout",
										color: "#1a745d",
										size: 191,
									},
								],
							},
						],
					},
				],
			},
		],
	};
	var circleFill = function (d) {
		if (d["color"]) {
			return d.color;
		} else {
			return d.children ? color(d.depth) : "#fff";
		}
	};
	var calculateTextFontSize = function (d) {
		return (
			Math.min(2 * d.r, ((2 * d.r - 8) / this.getComputedTextLength()) * 11) +
			"px"
		);
	};
	var margin = 20;
	diameter = 600;
	var color = d3.scale
		.linear()
		.domain([-1, 18])
		.range(["hsl(0,0%,100%)", "hsl(165, 66%, 53%)"])
		.interpolate(d3.interpolateHcl);
	var pack = d3.layout
		.pack()
		.padding(2)
		.size([diameter - margin, diameter - margin])
		.value(function (d) {
			return d.size;
		});
	var svg = d3
		.select("#circle-chart-container")
		.append("svg")
		.attr("width", 1200)
		.attr("height", 600)
		//.attr("preserveAspectRatio", "xMinYMin meet")
		//.attr("viewBox", `0 0 1200 1200`)
		.append("g")
		.attr("transform", "translate(" + diameter / 2 + "," + diameter / 2 + ")");
	var focus = root,
		nodes = pack.nodes(root),
		view;
	var circle = svg
		.selectAll("circle")
		.data(nodes)
		.enter()
		.append("circle")
		.attr("class", function (d) {
			return d.parent
				? d.children
					? "node"
					: "node node--leaf"
				: "node node--root";
		})
		.style("fill", circleFill)
		.on("click", function (d) {
			if (focus !== d) zoom(d), d3.event.stopPropagation();
		});
	circle.append("svg:title").text(function (d) {
		return d.name;
	});
	var text = svg
		.selectAll("text")
		.data(nodes)
		.enter()
		.append("text")
		.attr("class", "label")
		.style("fill-opacity", function (d) {
			return d.parent === root ? 1 : 0;
		})
		.style("display", function (d) {
			return d.parent === root ? null : "none";
		})
		.text(function (d) {
			return d.name;
		})
		.style("font-size", calculateTextFontSize)
		.attr("dy", ".35em");
	var node = svg.selectAll("circle,text");
	d3.select("body")
		.style("background", d3.color("#3db5e6"))
		.on("click", function () {
			zoom(root);
		});
	zoomTo([root.x, root.y, root.r * 2 + margin]);

	function zoom(d) {
		var focus0 = focus;
		focus = d;
		var transition = d3
			.transition()
			.duration(d3.event.altKey ? 7500 : 750)
			.tween("zoom", function (d) {
				var i = d3.interpolateZoom(view, [
					focus.x,
					focus.y,
					focus.r * 2 + margin,
				]);
				return function (t) {
					zoomTo(i(t));
				};
			});
		transition
			.selectAll("text")
			.filter(function (d) {
				return d.parent === focus || this.style.display === "inline";
			})
			.style("fill-opacity", function (d) {
				return d.parent === focus ? 1 : 0;
			})
			.each("start", function (d) {
				if (d.parent === focus) this.style.display = "inline";
			})
			.each("end", function (d) {
				if (d.parent !== focus) this.style.display = "none";
			});
	}

	function zoomTo(v) {
		var k = diameter / v[2];
		view = v;
		node.attr("transform", function (d) {
			return "translate(" + (d.x - v[0]) * k + "," + (d.y - v[1]) * k + ")";
		});
		circle.attr("r", function (d) {
			return d.r * k;
		});
	}
	d3.select(self.frameElement).style("height", diameter + "px");

	function add_data_to_chart() {
		var filters = localStorage.getItem("filters");
		$.getJSON(
			"https://kpi-tool.psglobalgroup.com/api/home-engagement.php",
			{ key: filters },
			function (data111) {
				// bar chart

				console.log(chartjsBar.data);
				chartjsBar.data.labels = data111.signup_time.label;
				chartjsBar.data.datasets[0].data = data111.signup_time.data;
				// chartjsBar.data.datasets[0].data[2] = 50; // Would update the first dataset's value of 'March' to be 50
				chartjsBar.update(); // Calling update now animates the position of March from 90 to 50.

				chartPageView.data.labels = data111.date_range;
				chartPageView.data.datasets[0].data =
					data111.user_enggement.total_views;
				chartPageView.data.datasets[1].data =
					data111.user_enggement.total_visitor;
				chartPageView.data.datasets[2].data =
					data111.user_enggement.total_unique;
				chartPageView.update();

				// word cloud
				seriesWord.data.setAll(data111.wordcloud);

				SeriesSankey.data.setAll(data111.journey_data);

				xAxisRadar.axisRanges.removeValue(axisRange0Radar);
				xAxisRadar.axisRanges.removeValue(axisRange1Radar);

				axisRange0Radar = xAxisRadar.createAxisRange(
					xAxisRadar.makeDataItem({
						above: true,
						value: 0,
						endValue: data111.retention_data,
					})
				);
				axisRange1Radar = xAxisRadar.createAxisRange(
					xAxisRadar.makeDataItem({
						above: true,
						value: data111.retention_data,
						endValue: 100,
					})
				);
				axisDataItemRadar.set("value", data111.retention_data);

				bulletRadar.get("sprite").on("rotation", function () {
					value = axisDataItemRadar.get("value");
					labelRadar.set("text", Math.round(value).toString() + "%");
				});

				var colorSet = am5.ColorSet.new(rootRadar, {});

				axisRange0Radar.get("axisFill").setAll({
					visible: true,
					fill: colorSet.getIndex(0),
				});

				axisRange0Radar.get("label").setAll({
					forceHidden: true,
				});

				axisRange1Radar.get("axisFill").setAll({
					visible: true,
					fill: colorSet.getIndex(4),
				});

				axisRange1Radar.get("label").setAll({
					forceHidden: true,
				});
			}
		);
	}
});

function add_data_to_chart() {
	var filters = localStorage.getItem("filters");
	$.getJSON(
		"https://kpi-tool.psglobalgroup.com/api/signup-overview.php",
		{ key: filters },
		function (data111) {
			console.log("data", data);
		}
	);
}
